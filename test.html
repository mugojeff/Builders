
<!DOCTYPE html>
<html lang="en">


<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="msapplication-tap-highlight" content="no">
    <meta name="description" content="GIG is a digital events management platform that helps in event planning and event management as it brings events to life. From event registration and event checkin to finding events in kenya or abroad. GIG also offers an events mobile app that helps make your event more than just an event but a great experience.">
    <title>Buy Ticket | &quot;GODZILLA vs KONG&quot; 2D Gold VIP Screening</title>
    
    <meta name="keywords" content="guiderig, guide, events, events dashboard, event management, events management,events planning,events in kenya, events app, android events">



  <!-- Favicons-->
  <link rel="icon" href="https://client.gig.co.ke/images/favicon/favicon-32x32.png&quot; sizes=&quot;32x32">
  <!-- Favicons-->
  <link rel="apple-touch-icon-precomposed" href="https://client.gig.co.ke/images/favicon/apple-touch-icon-152x152.png">
  <!-- For iPhone -->
  <meta name="msapplication-TileColor" content="#00bcd4">
  <meta name="msapplication-TileImage" content="images/favicon/mstile-144x144.png">
  <!-- For Windows Phone -->


  <!-- CORE CSS-->

  <link href="https://client.gig.co.ke/css/materialize.css" type="text/css" rel="stylesheet" media="screen,projection">
  <link href="https://client.gig.co.ke/css/material_icons.css" rel="stylesheet">

  <link href="https://client.gig.co.ke/css/style.css" type="text/css" rel="stylesheet" media="screen,projection">
    <!-- Custome CSS-->
    <link href="https://client.gig.co.ke/css/custom-style.css" type="text/css" rel="stylesheet" media="screen,projection">
  <link href="https://client.gig.co.ke/css/page-center.css" type="text/css" rel="stylesheet" media="screen,projection">

  <!-- INCLUDED PLUGIN CSS ON THIS PAGE -->
  <link href="https://client.gig.co.ke/css/prism.css" type="text/css" rel="stylesheet" media="screen,projection">
  <link href="https://client.gig.co.ke/js/plugins/perfect-scrollbar/perfect-scrollbar.css" type="text/css" rel="stylesheet" media="screen,projection">
  <link href="https://client.gig.co.ke/js/plugins/sweetalert/sweetalert.css" type="text/css" rel="stylesheet" media="screen,projection">

  <link href="https://client.gig.co.ke/js/plugins/inttel/css/intlTelInput.css" type="text/css" rel="stylesheet"
  media="screen,projection">

</head>

<body id="the_body" class="cyan">
  <!-- Start Page Loading -->
  <!-- End Page Loading -->
  <meta name="_token" content="o5attYQvIRBMnBsAKSEL7eqdLAz4Au00H68HQSPd" />

  <div class="container">
     <div class="row" style="max-width: 350px">
          <div class="col s12">

















</div>     </div>
  </div>

   
<!--  Start Register Content -->
<div id="register-page" class="row">
  <!--Form Advance-->
  <div class="row">
    <div class="col s12 m12 l12">
      <div class="card-panel">
        <div class="row">

          <input type="text" class="center login-form-text teal-text" disabled value="&quot;GODZILLA vs KONG&quot; 2D Gold VIP Screening">
        </div>
        <div class="input-field col s12 center">
          <img src="https://client.gig.co.ke/eventpics/gev_353_banner_pic" alt=""
            onerror="this.src='https://client.gig.co.ke/images/default_event_banner_pic.png'" height="150" width="500"
            class="responsive-img">

        </div>

        <div class="row">

          <input type="text" class="center login-form-text pink-text" disabled value="Buy Event Ticket">

        </div>

        <div class="row">
          <form id="reg-form" class="col s12">
            <input type="hidden" name="_token" value="o5attYQvIRBMnBsAKSEL7eqdLAz4Au00H68HQSPd">
            <meta name="_token" content="o5attYQvIRBMnBsAKSEL7eqdLAz4Au00H68HQSPd" />



            <div id="ticket-details">

              <div class="row center">
                <h5 id="ticket-summarry" class="teal-text center">Ticket Details</h5>
                <br>
                <div id="tick-desc" class="row hidden">
                  <h6 class="teal-text underline">About Ticket:</h6><br>
                  <h6 id="tick-description" class="grey-text">Ticket Description</h6>
                </div><br>

                <div class="input-field col s6 ">
                  <select name="ttype" id="ttype">
                    <option value="" disabled selected> Choose Ticket Type</option>

                    
                    
                                        <option value="VIP Screening" data-data="{&quot;id&quot;:1045,&quot;ticketeventid&quot;:&quot;gev_353&quot;,&quot;ticketprice&quot;:1000,&quot;tickettype&quot;:&quot;VIP Screening&quot;,&quot;tickettypeid&quot;:1,&quot;description&quot;:&quot;Enjoy the clash of mammoths in the comfort of electronic recliner leather seats at Century Cinemax, Sarit Your City.&quot;,&quot;expires&quot;:0,&quot;expiry_date&quot;:&quot;24 March, 2021&quot;,&quot;status&quot;:&quot;available&quot;,&quot;total_available&quot;:14,&quot;created_at&quot;:&quot;2021-03-16 15:21:24&quot;,&quot;updated_at&quot;:&quot;2021-03-17 13:48:43&quot;,&quot;ticketmode&quot;:&quot;individual&quot;,&quot;ticketmodenumber&quot;:2,&quot;ticket_amount&quot;:1000,&quot;currency&quot;:{&quot;id&quot;:1,&quot;sign&quot;:&quot;Ksh.&quot;,&quot;code&quot;:&quot;KES&quot;,&quot;country&quot;:&quot;KE&quot;,&quot;ratio&quot;:1,&quot;created_at&quot;:&quot;2018-01-23 22:04:04&quot;,&quot;updated_at&quot;:&quot;2018-01-23 22:04:04&quot;},&quot;event&quot;:{&quot;id&quot;:364,&quot;eventid&quot;:&quot;gev_353&quot;,&quot;eventname&quot;:&quot;\&quot;GODZILLA vs KONG\&quot; 2D Gold VIP Screening&quot;,&quot;eventadmin&quot;:&quot;jotham@moviejabber.co.ke&quot;,&quot;eventsummarry&quot;:&quot;\&quot;GODZILLA vs KONG\&quot; Gold VIP 2D Screening by MOVIE JABBER. At Century Cinemax Sarit Your City, Westlands. 2nd Floor, Rooftop Garden. ARRIVAL: 6:00PM. SCREENING: 7.00PM. Gold VIP Screen #4, VIP.  Film is in 2D only.  Film is 1hr 53 min long.&quot;,&quot;eventdescription&quot;:&quot;\&quot;GODZILLA vs KONG\&quot; Gold VIP 2D Screening organized by MOVIE JABBER. At Century Cinemax Sarit Your City, 2nd Floor, Rooftop Garden. ARRIVAL: 6:00PM. SCREENING: 7.00PM. Gold VIP Screen #4, VIP.  Film is in 2D only.  Film is 1hr 53 min long.&quot;,&quot;eventvenue&quot;:&quot;Century Cinemax Sarit Centre, Westlands.&quot;,&quot;eventlocation&quot;:&quot;-1.2611605,36.80197769999999&quot;,&quot;eventlocationname&quot;:&quot;Century Cinemax Sarit Centre, Westlands.&quot;,&quot;eventdate&quot;:&quot;24 March, 2021&quot;,&quot;eventtime&quot;:&quot;7:00 PM - 9:00 PM&quot;,&quot;eventactualstart&quot;:&quot;24\/3\/2021 19:00&quot;,&quot;eventstartdate&quot;:&quot;24 March, 2021&quot;,&quot;eventenddate&quot;:&quot;24 March, 2021&quot;,&quot;eventstarttime&quot;:&quot;7:00 PM&quot;,&quot;eventendtime&quot;:&quot;9:00 PM&quot;,&quot;eventcategory&quot;:&quot;Cinema&quot;,&quot;eventcategoryid&quot;:13,&quot;eventorganizername&quot;:&quot;Movie Jabber&quot;,&quot;eventorganizeremail&quot;:&quot;jotham@moviejabber.co.ke&quot;,&quot;eventorganizernumber&quot;:&quot;0726821899&quot;,&quot;eventorganizerposition&quot;:&quot;Event Support&quot;,&quot;eventprivate&quot;:&quot;false&quot;,&quot;eventmain&quot;:&quot;false&quot;,&quot;eventsponsored&quot;:&quot;false&quot;,&quot;eventfloorplan&quot;:&quot;false&quot;,&quot;eventtoday&quot;:&quot;false&quot;,&quot;eventpassed&quot;:&quot;false&quot;,&quot;event_day&quot;:&quot;upcoming&quot;,&quot;eventpaying&quot;:&quot;true&quot;,&quot;eventdataneeded&quot;:&quot;minimal&quot;,&quot;eventfacebook&quot;:&quot;https:\/\/www.facebook.com\/MovieJabber&quot;,&quot;eventtwitter&quot;:&quot;https:\/\/twitter.com\/MovieJabber&quot;,&quot;eventcustomregistration&quot;:&quot;false&quot;,&quot;eventcustomregistrationurl&quot;:&quot;https:\/\/gig.co.ke&quot;,&quot;eventcustomfeedback&quot;:&quot;false&quot;,&quot;eventcustomfeedbackurl&quot;:&quot;https:\/\/gig.co.ke&quot;,&quot;eventonlineattendeeurl&quot;:&quot;https:\/\/client.gig.co.ke\/event\/gev_353\/checkin&quot;,&quot;eventonlinersvpurl&quot;:&quot;https:\/\/client.gig.co.ke\/event\/gev_353\/rsvp&quot;,&quot;eventticketbuyurl&quot;:&quot;https:\/\/client.gig.co.ke\/event\/gev_353\/ticket&quot;,&quot;eventticketstatus&quot;:&quot;available&quot;,&quot;eventdays&quot;:1,&quot;eventgoing&quot;:40,&quot;eventcheckedin&quot;:0,&quot;eventstatus&quot;:&quot;active&quot;,&quot;eventpackage&quot;:&quot;lite&quot;,&quot;eventcost&quot;:0,&quot;eventextras&quot;:&quot;{\&quot;currency\&quot;:\&quot;1\&quot;}&quot;,&quot;eventsettings&quot;:&quot;{\&quot;ticketspertransaction\&quot;:5,\&quot;ticketstotal\&quot;:\&quot;49\&quot;,\&quot;has_checkin_success_email\&quot;:true,\&quot;has_checkin_success_sms\&quot;:true,\&quot;has_rsvp_success_email\&quot;:true,\&quot;has_rsvp_success_sms\&quot;:true,\&quot;has_custom_checkin_email\&quot;:false,\&quot;has_custom_rsvp_email\&quot;:false,\&quot;has_custom_event_email\&quot;:false,\&quot;has_custom_checkin_sms\&quot;:false,\&quot;has_custom_rsvp_sms\&quot;:false,\&quot;has_custom_ticket_sms\&quot;:false,\&quot;custom_checkin_email_template\&quot;:\&quot;\&quot;,\&quot;custom_rsvp_email_template\&quot;:\&quot;\&quot;,\&quot;custom_event_email_template\&quot;:\&quot;\&quot;,\&quot;custom_checkin_sms_template\&quot;:\&quot;\&quot;,\&quot;custom_rsvp_sms_template\&quot;:\&quot;\&quot;,\&quot;custom_ticket_sms_template\&quot;:\&quot;\&quot;,\&quot;event_color\&quot;:\&quot;#039be5\&quot;,\&quot;event_color_secondary\&quot;:\&quot;#ff9334\&quot;,\&quot;event_mode\&quot;:\&quot;normal\&quot;}&quot;,&quot;eventstats&quot;:&quot;{\&quot;attending\&quot;:40,\&quot;declined\&quot;:0,\&quot;maybe\&quot;:0,\&quot;noreply\&quot;:0,\&quot;attended\&quot;:0}&quot;,&quot;created_at&quot;:&quot;2021-03-04 20:09:41&quot;,&quot;updated_at&quot;:&quot;2021-03-17 13:55:47&quot;,&quot;isprintingenabled&quot;:false,&quot;isreportsenabled&quot;:false,&quot;currency&quot;:&quot;KES&quot;,&quot;eventcode&quot;:&quot;G353&quot;}}"
                      data-price="1000" data-tid="1">
                      VIP Screening : 1000 KES.
                    </option>
                                        
                    
                  </select>
                  <label>Type of Ticket</label>
                                  </div>
                <input name="tprice" id="tprice" class="hidden" type="text" value="">
                <input name="tid" id="tid" class="input-field hidden" type="text" value="">
                <input name="tickettypeid" id="tickettypeid" class="input-field hidden" type="text"
                  value="">

                <div id="tnumber-section" class="input-field col s6 ">
                  <select name="tnumber" id="tnumber">
                    <option value="" disabled selected>Number of Tickets</option>

                                          <option value="1">1</option>
                                            <option value="2">2</option>
                                            <option value="3">3</option>
                                            <option value="4">4</option>
                                            <option value="5">5</option>
                      
                  </select>
                  <label>Number of Tickets</label>
                  
                </div>

              </div>



            </div>


            <div class="row">
              <div class="input-field col s6 ">
                <input name="refx" id="refx" class="hidden" type="text" value="1">
                <input name="treferall" id="treferall" class="hidden" type="text" value="GIG">
                <input name="fname" id="fname" class="validate" type="text" value="" required>
                <label for="fname"><span><i class="mdi-action-account-circle bottom"></i></span> First Name</label>
                              </div>

              <div class="input-field col s6 ">
                <input name="lname" id="lname" class="validate" type="text" value="" required>
                <label for="lname"><span><i class="mdi-action-account-circle bottom"></i></span> Last Name</label>
                              </div>
            </div>
            <div class="row">
              <div class="input-field col s6 ">
                <input name="email" id="email" class="validate" type="text" value="" required>
                <label for="email"><span><i class="mdi-communication-email bottom"></i></span> Email</label>
                              </div>

              <div class="input-field col s6 ">
                <input name="number" id="number" class="validate" type="tel" value="" required>
                                <span id="valid-msg" class="hide">âœ“ Valid</span>
                <span id="error-msg" class="hide"></span>
              </div>


            </div>


            
            <div style="padding-left:20px;" id="children-section" class="row hidden">
              <p>Other Attendee Names <span class="tooltipped" data-position="top"
                  data-tooltip="Enter the other attendee names (or leave blank to use your name for all tickets)"><i
                    class="mdi-action-info middle"></i></span></p>
              <div id="child-items" class="row">

              </div>

            </div>

            <div class="row">
              <div class="input-field col s12">
                <select name="pay-via">
                  <option value="0" disabled> Make Payment Via?</option>
                  <option value="mpesa" selected>Pay Via MPESA</option>
                  <option value="card">Pay Via Card</option>
                </select>
                <label>Make Payment Via</label>
              </div>

            </div>

            <div style="margin-top: 10px" class="row">
              <div id="btn-referall" class="center-align pink-text hover_icon">
                <p class="underline">Do you have a Referall Code?</p>
              </div>

              <div id="applied-view" class="center-align hidden">
                <p class="center-align">Applied Referall Code: <span id="applied-code" class="pink-text">XXX</span></p>
              </div>

              <div class="input-field col s12">

                <!--   Start Loader-->
                <div class="center-align" id="progressbar" style="display:none;">
                  <div class="preloader-wrapper small active">
                    <div class="spinner-layer spinner-blue">
                      <div class="circle-clipper left">
                        <div class="circle"></div>
                      </div>
                      <div class="gap-patch">
                        <div class="circle"></div>
                      </div>
                      <div class="circle-clipper right">
                        <div class="circle"></div>
                      </div>
                    </div>

                    <div class="spinner-layer spinner-red">
                      <div class="circle-clipper left">
                        <div class="circle"></div>
                      </div>
                      <div class="gap-patch">
                        <div class="circle"></div>
                      </div>
                      <div class="circle-clipper right">
                        <div class="circle"></div>
                      </div>
                    </div>

                    <div class="spinner-layer spinner-yellow">
                      <div class="circle-clipper left">
                        <div class="circle"></div>
                      </div>
                      <div class="gap-patch">
                        <div class="circle"></div>
                      </div>
                      <div class="circle-clipper right">
                        <div class="circle"></div>
                      </div>
                    </div>

                    <div class="spinner-layer spinner-green">
                      <div class="circle-clipper left">
                        <div class="circle"></div>
                      </div>
                      <div class="gap-patch">
                        <div class="circle"></div>
                      </div>
                      <div class="circle-clipper right">
                        <div class="circle"></div>
                      </div>
                    </div>

                  </div>
                </div>
                <!--   End Loader-->

                <input id="errormsg" type="text" class="center login-form-text pink-text" style="display:none"
                  value="Results">

                <div class="=row">

                  <div class="print-error-msg" style="display:none">
                    <div class="container">
                      <ul class="collection"></ul>
                    </div>
                  </div>
                  <button id="btn-mpesa" type="submit" class="btn-large green waves-effect waves-light col s12">BUY
                    TICKET FROM MPESA</button>

                  <button class="btn-large waves-effect waves-light col s12 hidden" type="button"
                    style="cursor:pointer;" value="Pay Now" id="btn-card">Make CARD Payment</button>


                </div>



              </div>

            </div>

            <div name="form-footer">
      <div class="margin-top shadow">
        <div class="divider"></div>
        <p class="center middle">View more details about this event</p>

                <div class="row center">

         <a href="https://m.me/gigeventsbot?ref=G353" target="_blank"><img class="" height="80" width="80" src="https://client.gig.co.ke/images/facebook_bot.png" alt="" class="responsive-img bottom"></a>

         <a href="https://t.me/gigeventsbot_bot?start=G353" target="_blank"><img class="margin-left-left-left" height="75" width="75" src="https://client.gig.co.ke/images/telegram_bot.png" alt="" class="responsive-img bottom"></a>
       </div>

        
      </div>
      <div class="center">
        <p class="center middle">Powered  by</p>
        <img src="https://client.gig.co.ke/images/logo_blue.png" alt="" class="responsive-img bottom">
      </div>
    </div>


          </form>
        </div>
      </div>
    </div>
  </div>

</div> <!--  End Register Content -->


<!-- ================================================
    Scripts
    ================================================ -->

  <!-- jQuery Library -->
  <script type="text/javascript" src="https://client.gig.co.ke/js/jquery-1.11.2.min.js"></script>
  <!--materialize js-->
  <script type="text/javascript" src="https://client.gig.co.ke/js/materialize.js"></script>
  <!--prism-->
  <script type="text/javascript" src="https://client.gig.co.ke/js/prism.js"></script>
  <!--scrollbar-->
  <script type="text/javascript" src="https://client.gig.co.ke/js/plugins/perfect-scrollbar/perfect-scrollbar.min.js"></script>
 <!--clamp-->
   <script type="text/javascript" src="https://client.gig.co.ke/js/plugins/clamp/clamp.min.js"></script>
  <!--plugins.js - Some Specific JS codes for Plugin Settings-->
  <script type="text/javascript" src="https://client.gig.co.ke/js/plugins.js"></script>
    <!--sweetalert -->
  <script type="text/javascript" src="https://client.gig.co.ke/js/plugins/sweetalert/sweetalert.min.js"></script>

  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-72822014-3"></script>


 <script type="text/javascript">

   $(document).on( 'click','.close',function (e) {
      e.preventDefault(e);
          $(this).closest("#card-alert").fadeOut("slow");
     });

    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    
    $('.datepicker').on('mousedown', function(e){
        e.preventDefault();
    });

    $('.timepicker').on('mousedown', function(e){
        e.preventDefault();
    });

    gtag('config', 'UA-72822014-3');


    $.ajaxSetup(
    {
       headers: {
        'X-CSRF-TOKEN': $('meta[name="_token"]').attr('content')
        }
    });

    function setCookie(name,value,days) {
      var expires = "";
      if (days) {
          var date = new Date();
          date.setTime(date.getTime() + (days*24*60*60*1000));
          expires = "; expires=" + date.toUTCString();
      }
      document.cookie = name + "=" + (value || "")  + expires + "; path=/";
  }
  function getCookie(name) {
      var nameEQ = name + "=";
      var ca = document.cookie.split(';');
      for(var i=0;i < ca.length;i++) {
          var c = ca[i];
          while (c.charAt(0)==' ') c = c.substring(1,c.length);
          if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length,c.length);
      }
      return null;
  }
  function eraseCookie(name) {   
      document.cookie = name+'=; Max-Age=-99999999;';  
  }


  </script>
  
<script type="text/javascript" src="https://api.ravepay.co/flwv3-pug/getpaidx/api/flwpbf-inline.js"></script>
<script type="text/javascript" src="https://client.gig.co.ke/js/plugins/inttel/js/intlTelInput.js"></script>
<!-- <script type="text/javascript" src="https://ravesandboxapi.flutterwave.com/flwv3-pug/getpaidx/api/flwpbf-inline.js"></script> -->

<script type="text/javascript">
  //-----------Start International Phone Number-------------------------
  var input = document.querySelector("#number");
  var countryCode= getCookie('countryCode');
  window.intlTelInput(input, {
      dropdownContainer: document.body,
      initialCountry: "auto",
      geoIpLookup: function(callback) {
        if(countryCode == undefined || countryCode == null)
        {
            $.get("https://ipinfo.io", function() {}, "jsonp").always(function(resp) {
            countryCode = (resp && resp.country) ? resp.country : "";
            setCookie('countryCode',countryCode,7);
            callback(countryCode);
           });
        }
        
      },
      preferredCountries: ['ke'],
      utilsScript: "https://client.gig.co.ke/js/plugins/inttel/js/utils.js",
    });

  // initialise plugin
  var iti = window.intlTelInput(input, {
    initialCountry:"KE",
    utilsScript: "https://client.gig.co.ke/js/plugins/inttel/js/utils.js"
  });

  iti.promise.then(function() {
    //Finished Intitializing
    if(countryCode != null){iti.setCountry(countryCode);}
  });


  //Valid PhoneNUmber
  errorMsg = document.querySelector("#error-msg"),
  validMsg = document.querySelector("#valid-msg");

  // here, the index maps to the error code returned from getValidationError - see readme
  var errorMap = ["Invalid number", "Invalid country code", "Too short", "Too long", "Invalid number"];
  var reset = function() {
    input.classList.remove("error");
    errorMsg.innerHTML = "";
    errorMsg.classList.add("hide");
    validMsg.classList.add("hide");
  };

  // on blur: validate
  input.addEventListener('blur', function() {
    reset();
    if (input.value.trim()) {
      if (iti.isValidNumber()) {
        validMsg.classList.remove("hide");
      } else {
        input.classList.add("error");
        var errorCode = iti.getValidationError();
        errorMsg.innerHTML = errorMap[errorCode];
        errorMsg.classList.remove("hide");
      }
    }
  });

  // on keyup / change flag: reset
  input.addEventListener('change', reset);
  input.addEventListener('keyup', reset);

//-----------End International Phone Number-------------------------

$(document).ready(function(){
$('.tooltipped').tooltip();
});

  $("#refx").val("1");
  $("#treferall").val("GIG");
  $('#btn-referall').show();
  $('#applied-view').hide();

  var ticketPrice=0;
  var ticketNumber=0;
  var ticketCost=0;
  var ticketMode="individual";
  var ticketModeNumber=1;
  var ticketType="";
  var ticketTypeMainId="";
  var ticketTypeId="";

  var eventPaying =  "true";
  if(eventPaying == "true")
  {

   $("[name='ttype']").change(function(){
      

      var ticket= $(this).find(':selected').data("data");
      ticketPrice =  $(this).find(':selected').data("price");
      ticketType =  this.value;
      ticketTypeMainId =  ticket.id;
      ticketTypeId =  $(this).find(':selected').data("tid");
      ticketNumber= $("[name='tnumber']").val();
      $("[name='tprice']").val(ticketPrice);
      $("[name='tid']").val(ticketTypeId);
      $("[name='tickettypeid']").val(ticketTypeMainId);

      $('#tick-desc').show();
      $('#tick-description').text(ticket.description);

      ticketMode=ticket.ticketmode;
      ticketModeNumber=ticket.ticketmodenumber;
      

      if(ticket.ticketmode == "group")
      {
         ticketNumber=1;

      

        $("#child-items").empty();
        for(var i=0;i<ticket.ticketmodenumber-1;i++)
        {
          $("#child-items").append('<div class="input-field col s12"><input id="child-'+i+'" name="children['+i+']" class="validate child-item-class" type="text"><label for="child-'+i+'"><span><i class="mdi-action-account-circle bottom"></i></span> '+(i+1)+'.  Attendee Name</label></div>');
        }

         $("#tnumber").val(ticketNumber);
         $("#tnumber-section").hide();
         $("#children-section").show();
         $("#children-count").text(ticketModeNumber-1);
         $('select').material_select();
       

      }
      else
      {
        $("#child-items").empty();
        ticketNumber=1;
        $("#tnumber").val(1);
        $("#tnumber-section").show();
        $("#children-section").hide();
        $('select').material_select();
       
      }

     if(ticketNumber !== null && ticketPrice !== null)

     {
        ticketCost = ticketPrice * ticketNumber * $("#refx").val();
        ticketCost=Math.round(ticketCost);
        $('#ticket-summarry').text("Total Cost "+ticketCost+" KES.");
      
     }

   

   });

   if("" != "")
   {
      var refCode= "";
      var eventId= "gev_353";

      postConfirmReferallCode(eventId,refCode);
   }

  
//  $('.chips-placeholder').material_chip({
//       placeholder: 'Attendee Name',
//       secondaryPlaceholder: 'Attendee Name',
//       allowDuplicates: true,
//   });
  
  
//   $('.chips-placeholder').on('chip.add', function(e, chip){
//   // you have the added chip here
//   children.push(chip.tag);
//   var i = children.indexOf(chip.tag);

//   if(children.length < ticketModeNumber)
//   {
//    //children.push(chip.tag);
//    //alert("None");
//   }
//   else{

//     swal({
//                     title: "Can Only Add "+(children.length-1)+" name(s).",
//                     html:true,
//                     text: "Including yourself, You can only add "+ (children.length-1)+" name(s) for the "+ticketType+" ticket",
//                     type: "error",
//                     closeOnConfirm: true,

//                 });
//       // chip.deleteChip(0);
//       console.log(this);
//       console.log(i);
//        if(i > -1) {$(this).find(':nth-child('+(i+1)+')').remove()};
//        if(i > -1) {children.splice(i, 1);}
     
//   }

//   console.log(children);
//   });
  
//   $('.chips-placeholder').on('chip.delete', function(e, chip){
//   // you have the deleted chip here
//   // Find and remove item from an array
//   var i = children.indexOf(chip.tag);
//   if(i > -1) {
//     children.splice(i, 1);
//   }
//   //console.log(i);
//   //console.log(children);
  
//   });

   $("[name='pay-via']").change(function(){

      var selected =  this.value;
     

     if(selected == "card" )

     {
        $("#btn-card").show();
        $("#btn-mpesa").hide();
     }
     else
     {
       $("#btn-card").hide();
       $("#btn-mpesa").show();
     }


   });

   $("[name='tnumber']").change(function(){

      var ticket= $("[name='ttype']").find(':selected').data("data");
      ticketPrice= $("[name='ttype']").find(':selected').data("price");
      ticketNumber = this.value;
      $("[name='tprice']").val(ticketPrice);

     if(ticketNumber !== null && ticketPrice !== null)

       {
          if(ticketNumber>1)
          {
            $("#children-section").show();
            $("#children-count").text(ticketNumber-1);

            $("#child-items").empty();
            for(var i=0;i<ticketNumber-1;i++) { 
              $("#child-items").append('<div class="input-field col s12"><input id="child-'+i+'" name="children['+i+']" class="validate child-item-class" type="text"><label for="child-'+i+'"><span><i class="mdi-action-account-circle bottom"></i></span> '+(i+1)+'. Attendee Name</label></div>');
              }
          }
          else
          {
            $("#child-items").empty();
            $("#children-section").hide();
          }

          console.log(ticket);
          ticketCost = ticketPrice * ticketNumber * $("#refx").val();
          ticketCost=Math.round(ticketCost);
          $('#ticket-summarry').text("Total Cost "+ticketCost+" KES.");
          $('#tick-desc').show();
          $('#tick-description').text(ticket.description);
      }

  });

 }

 $("[name='number']").keydown(function (e) {
        // Allow: backspace, delete, tab, escape, enter and .
        if ($.inArray(e.keyCode, [46, 8, 9, 27, 13, 110, 190]) !== -1 ||
             // Allow: Ctrl+A
             (e.keyCode == 65 && e.ctrlKey === true) ||
             // Allow: Ctrl+C
             (e.keyCode == 67 && e.ctrlKey === true) ||
             // Allow: Ctrl+X
             (e.keyCode == 88 && e.ctrlKey === true) ||
             // Allow: home, end, left, right
             (e.keyCode >= 35 && e.keyCode <= 39)) {
                 // let it happen, don't do anything
               return;
             }
        // Ensure that it is a number and stop the keypress
        if ((e.shiftKey || (e.keyCode < 48 || e.keyCode > 57)) && (e.keyCode < 96 || e.keyCode > 105)) {
          e.preventDefault();
        }
      });

 $('#reg-form').on('submit',function(e){
  $.ajaxSetup({
    header:$('meta[name="_token"]').attr('content')
  })
  e.preventDefault(e);
  $('#progressbar').show();
  $('#the_body').addClass("teal");
  $(".print-error-msg").hide();

  document.getElementById('number').value = iti.getNumber();
  var dataString=$(this).serialize();
  console.log(dataString);

  $.ajax({

    type:"POST",
    url:'/event/gev_353/ticket',
    data:dataString,
    dataType: 'json',
    success: function(response){

      var result_code = response.result_code;
      var data = response.data;
      console.log(response);
      if(result_code == 0)
        {
          $('#progressbar').hide();
          confirmInfo(data);
        }
        else
        {
          $('#progressbar').hide();
          printErrorMsg(response.error);
        }
    },
    error: function(response)
    {
     printErrorMsg(response.error);

   }
 })

});

 function printErrorMsg (msg) {

  $(".print-error-msg").show();
  $(".print-error-msg").find("ul").html('');
  $(".print-error-msg").css('display','block');
  $.each( msg, function(key, value ) {
    $(".print-error-msg").find("ul").append('<li class=" rsvp-back white-text collection-item">'+value+'</li>');
  });

}


function confirmInfo(data)
{
  swal({
    title: "Confirm Number",
    text: "Amount : <span class='pink-text'> " + (data.tamount) + " KSH.</span> for <span class='pink-text'> "+data.tnumber+ " </span> tickets  MPESA Number : <span class='pink-text'> " + data.number + " </span>",
    html:true,
    showCancelButton: true,
    confirmButtonColor: "#e91e63",
    confirmButtonText: "Proceed with payment",
    cancelButtonText: "Cancel",
    closeOnConfirm: false,
  },
  function(isConfirm){
    if (isConfirm)
    {
            //Proceed


            $('#errormsg').val("...BuyTicket..");
            Materialize.toast('<span class="yellow-text">'+ "...Making Payment Request..." +'</span>', 1000);
            $('#progressbar').show();
            $('#the_body').addClass("teal");


            swal({
              title: "Requesting Payment<span class='pink-text'> "+ data.number+"</span>",
              text: "Wait 3 to 5 seconds and enter your MPESA Pin on the pop up.",
              html:true,
              showLoaderOnConfirm: true,
              closeOnConfirm: false,
            },

            function(isConfirm){
              if (isConfirm){
              }
              else
              {
              }
            });

            makePayment(data);

          }
          else
          {
            //Change Details
          }
        });

}

function makePayment(data)
{

  var ticketAmount = data.tamount / $("#refx").val();
  var eventId= "gev_353".split("_");
  var eId= eventId[1];
  var ticketAccountNumber = "G"+eId+data.tid;

  $.ajax({

    type:"POST",
    url:'/api/make_payment',
    data:data,
    dataType: 'json',
    success: function(response){

      var result_code = response.result_code;
      var data = response.data;
      console.log(response);
      if(result_code == 0)
      {
       dispResponse = 'Payment initiated successfully';

       swal({
        title: "Enter MPESA Pin on <span class='pink-text'> "+ data.number +"</span>",
        text: "Wait 3 to 5 seconds and enter your MPESA Pin on the pop up.",
        html:true,
        closeOnConfirm: true,
        closeOnCancel:false,
        showCancelButton: true,
        confirmButtonColor: "#e91e63",
        confirmButtonText: "Done: I have made payment",
        cancelButtonText: "No pop-up ? Pay manually via PayBill",

      },


      function(isConfirm){
        if (isConfirm)
        {
          

            postConfirmPayment(data.transactionid);

         }
         else
         {
          $('#progressbar').hide();

            swal({
            title: "Pay Manually Using Paybill",
            text: "1. Go to your M-PESA Menu<br>2. Select Lipa na M-PESA<br>3. Select Paybill<br>4.Enter Business Number <span class='black-text strong'> 672683 </span><br>5. Enter Account Number <span class='black-text strong'>"+ticketAccountNumber+"</span><br>6. Enter Amount <span class='black-text strong'>"+ticketAmount+"</span></br> Enter your MPESA pin to make payment.",
            html:true,
            closeOnConfirm: true,
            showCancelButton: true,
            confirmButtonColor: "#e91e63",
            confirmButtonText: "Done: I have made payment",
            cancelButtonText: "Cancel",

              },
               function(isConfirm){
                if (isConfirm){

                   //Close
                    $('#reg-form')[0].reset();
                    $('select').material_select();
                    $("html, body").animate({ scrollTop: 0 }, "slow");
                    $('#progressbar').hide();

                    $("#refx").val("1");
                    $("#treferall").val("GIG");
                    $('#btn-referall').show();
                    $('#applied-view').hide();
                    $("#children-section").hide();

                    swal.close();
                }
                else
                {
                }
              });

         }
       });

     }
     else
     {
      dispResponse = "Could not initiate payment on <span class='pink-text'>"+ data.number +"</span>";
      $('#errormsg').val("Payment request failed.");
      $('#progressbar').hide();

      swal({
        title: "Payment request failed",
        text: "1. Go to your M-PESA Menu<br>2. Select Lipa na M-PESA<br>3. Select Paybill<br>4.Enter Business Number <span class='black-text strong'> 672683 </span><br>5. Enter Account Number <span class='black-text strong'>"+ticketAccountNumber+"</span><br>6. Enter Amount <span class='black-text strong'>"+ticketAmount+"</span></br> Enter your MPESA pin to make payment.",
        html:true,
        closeOnCancel: false,
        confirmButtonText: "Try again",
        cancelButtonText: "No pop-up ? Pay manually via PayBill",
        closeOnConfirm: true,
      },
      function(isConfirm){
        if (isConfirm){
        }
        else
        {
             swal({
            title: "Pay Manually Using Paybill",
            text: "1. Go to your M-PESA Menu<br>2. Select Lipa na M-PESA<br>3. Select Paybill<br>4.Enter Business Number <span class='black-text strong'> 672683 </span><br>5. Enter Account Number <span class='black-text strong'>"+ticketAccountNumber+"</span><br>6. Enter Amount <span class='black-text strong'>"+ticketAmount+"</span></br> Enter your MPESA pin to make payment.",
            html:true,
            closeOnConfirm: true,
            showCancelButton: true,
            confirmButtonColor: "#e91e63",
            confirmButtonText: "Done: I have made payment",
            cancelButtonText: "Cancel",

              },
               function(isConfirm){
                if (isConfirm){

                   //Close
                    $('#reg-form')[0].reset();
                    $('select').material_select();
                    $("html, body").animate({ scrollTop: 0 }, "slow");
                    $('#progressbar').hide();

                    $("#refx").val("1");
                    $("#treferall").val("GIG");
                    $('#btn-referall').show();
                    $('#applied-view').hide();
                    $("#children-section").hide();

                    swal.close();
                }
                else
                {
                }
              });
        }
      });
    }

    showResponse(dispResponse);
  },
  error: function(response)
  {
   dispResponse = "Could not initiate payment on <span class='pink-text'>"+ data.number+"</span>";
      $('#errormsg').val("Payment request failed.");
      $('#progressbar').hide();

      swal({
        title: "Payment request failed",
        text: "1. Go to your M-PESA Menu<br>2. Select Lipa na M-PESA<br>3. Select Paybill<br>4.Enter Business Number <span class='black-text strong'> 672683 </span><br>5. Enter Account Number <span class='black-text strong'>"+ticketAccountNumber+"</span><br>6. Enter Amount <span class='black-text strong'>"+ticketAmount+"</span></br> Enter your MPESA pin to make payment.",
        html:true,
        closeOnCancel: false,
        confirmButtonText: "Try again",
        cancelButtonText: "No pop-up ? Pay manually via PayBill",
        closeOnConfirm: true,
      },
      function(isConfirm){
        if (isConfirm){
        }
        else
        {
          swal({
            title: "Pay Manually Using Paybill",
            text: "1. Go to your M-PESA Menu<br>2. Select Lipa na M-PESA<br>3. Select Paybill<br>4.Enter Business Number <span class='black-text strong'> 672683 </span><br>5. Enter Account Number <span class='black-text strong'>"+ticketAccountNumber+"</span><br>6. Enter Amount <span class='black-text strong'>"+ticketAmount+"</span></br> Enter your MPESA pin to make payment.",
            html:true,
            closeOnConfirm: true,
            showCancelButton: true,
            confirmButtonColor: "#e91e63",
            confirmButtonText: "Done: I have made payment",
            cancelButtonText: "Cancel",

              },
               function(isConfirm){
                if (isConfirm){

                   //Close
                    $('#reg-form')[0].reset();
                    $('select').material_select();
                    $("html, body").animate({ scrollTop: 0 }, "slow");
                    $('#progressbar').hide();

                    $("#refx").val("1");
                    $("#treferall").val("GIG");
                    $('#btn-referall').show();
                    $('#applied-view').hide();
                    $("#children-section").hide();

                    swal.close();
                }
                else
                {
                }
              });
        }
      });

  }
})
}


$("#btn-referall").on('click', function (){

  var eventId= "gev_353";

  //Were good so show prompt
    swal({ title: "Referall Code",
                     text: "Enter Referall Code to Apply",
                     type: "input",   showCancelButton: true,
                     closeOnConfirm: false,
                     html:true,
                     animation: "slide-from-top",
                     confirmButtonColor: "#e91e63",
                     showLoaderOnConfirm: true,

                     inputPlaceholder: "Enter Referall Code" },
                     function(inputValue){
                         if (inputValue === false) return false;

                         if (inputValue < 1)
                         {
                          swal.showInputError("You need to enter a referall code.");
                         return false;
                         }

                        var rCode = inputValue;
                        rCode= rCode.toUpperCase();
                        rCode = rCode.replace(/\s+/g, '');

                       //Confirm
                       postConfirmReferallCode(eventId, rCode);

                });


});


function postConfirmReferallCode(eventId, rCode)
{

    var dataString = 'eventid='+ eventId + '&rcode='+ rCode;

    $.ajax({
        type: "POST",
        url: "/api/event/referall/code/confirm",
        data: dataString,
        cache: false,
        success: function(response)
        {

            var result_code = response.result_code;
            var data = response.data;
            var message = response.message;
            console.log(response);

            if(result_code == 0)
            {

              dispResponse = 'Successfully Applied Referall Code : '+rCode;
              var dxRef= (100 - data.discount_percentage) / 100;
              $("#refx").val(dxRef);
              $("#treferall").val(rCode);

               var tCost = ticketCost * $("#refx").val();
               tCost=Math.round(tCost);
               $('#ticket-summarry').text("Total Cost "+tCost+" KES.");


              $('#btn-referall').hide();
              $('#applied-view').show();

              if(data.discount_percentage > 0)
              {
                  $('#applied-code').text(rCode +" : "+ data.discount_percentage+"% Off");
              }
              else
              {
                  $('#applied-code').text(rCode);
              }


              swal({
                title: "Success",
                text: "Successfully Applied Referall Code <span class='pink-text'>"+rCode +" : "+ data.discount_percentage+"% Off</span>" ,
                type: "success",
                html:true,
                closeOnConfirm: true,

            });

          }
          else
          {

            dispResponse = 'Failed. Could not apply referall code';

            swal({
                title: "Failed",
                html:true,
                text: message,
                type: "error",
                closeOnConfirm: true,

            });




        }

        showResponse(dispResponse);

    },
     error: function(response)
      {

             swal({
                title: "Failed",
                html:true,
                text: "Could not apply referall code. Try again or contact admin if problem continues" ,
                type: "error",
                closeOnConfirm: true,

            });


     }

});

}


function postConfirmPayment(transactionId)
{
      $('#errormsg').val("...Confirming Payment..");
            Materialize.toast('<span class="yellow-text">'+ "...Confirming Payment..." +'</span>', 1000);
            $('#progressbar').show();
            $('#the_body').addClass("teal");

            swal({
              title: "Confirming..",
              text: "Confirming the payment...",
              html:true,
              showLoaderOnConfirm: true,
              closeOnConfirm: false,
            });

    var dataString = 'transactionid='+ transactionId;

        $.ajax({
        type: "POST",
        url: "/api/confirm_payment",
        data: dataString,
        cache: false,
        success: function(response)
        {

        var result_code = response.result_code;
        var data = response.data;
        var message = response.message;
        console.log(response);
        $('#progressbar').hide();

        if(result_code == 0)
        {

                  dispResponse = 'Successfully Confirmed Payment';
                  

                  swal({
                  title: "Success",
                  text: "Ticket(s) purchased successfully. You will receive an SMS or email notification shortly with your e-Ticket(s)." ,
                  type: "success",
                  confirmButtonColor: "#e91e63",
                  confirmButtonText: "View More Events",
                  html:true,
                  closeOnConfirm: true,

                  },function(isConfirm){

                     location.href ="https://gig.co.ke";
                  });

        }
        else
        {

              dispResponse = message;

              swal({
              title: "Pending",
              html:true,
              text: message,
              type: "info",
               showCancelButton: true,
               confirmButtonColor: "#e91e63",
              closeOnConfirm: true,
              confirmButtonText: "Done",
              cancelButtonText: "Confirm Payment Again",


              },function(isConfirm){
                if (isConfirm){

                   location.href ="https://gig.co.ke";
                }
                else
                {
                  postConfirmPayment(transactionId);
                }
              });




        }

        showResponse(dispResponse);

        },
        error: function(response)
        {

            swal({
            title: "Failed",
            html:true,
            text: "Could not confirm payment.If you have made the payment you should receive an SMS or email shortly. If not try again or contact admin if problem continues" ,
            type: "error",
            closeOnConfirm: true,

            });


        }

        });

}

function showResponse(response)
{
  Materialize.toast('<span class="yellow-text">'+ response +'</span>', 2500);
}


function generateRandomString() {
  var length=12;
  var chars= '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ';

  var result = '';
  for (var i = length; i > 0; --i) result += chars[Math.floor(Math.random() * chars.length)];
    return result;
}

function getCurrentDate()
{

    var today = new Date();
    var dd = today.getDate();
var mm = today.getMonth()+1; //January is 0!
var yyyy = today.getFullYear();

if(dd<10) {
    dd='0'+dd
}

if(mm<10) {
    mm='0'+mm
}

today = dd+'/'+mm+'/'+yyyy;

return today;

}



function getCurrentTime() {
    var d = new Date( );
    d.setHours( d.getHours()); // offset from local time
    var h = (d.getHours() % 12) || 12; // show midnight & noon as 12
    return (
        ( h < 10 ? '0' : '') + h +
        ( d.getMinutes() < 10 ? ':0' : ':') + d.getMinutes() +
                // optional seconds display
        // ( d.getSeconds() < 10 ? ':0' : ':') + d.getSeconds() +
        ( d.getHours() < 12 ? ' AM' : ' PM' )
        );

}

function getRandomAgeBetween(min,max) // min and max included
{
    return Math.floor(Math.random()*(max-min+1)+min);
}


//Start Card Payments -->

document.addEventListener("DOMContentLoaded", function(event) {
  document.getElementById("btn-card").addEventListener("click", function(e) {
    var PBFKey = "FLWPUBK-d7991c8d770df7db5045ffa05f31724e-X";

     var eventId="gev_353";
     var eventName="&quot;GODZILLA vs KONG&quot; 2D Gold VIP Screening";
     var userFName= $("[name='fname']").val();
     var userLName= $("[name='lname']").val();
     var userEmail= $("[name='email']").val();
     var userNumber= $("[name='number']").val();
     var userCompanyName= $("[name='company']").val();
     var userOccupation= $("[name='occupation']").val();
     var userGender= $("[name='gender']").val();
     var userAge= $("[name='age']").val();

     var tDescription="Buy "+ticketNumber+" "+ticketType+" Tickets for the "+eventName+" event.";
     var tLogo="https://gig.co.ke/images/logo.png";
     var tTitle="Buy "+ticketNumber+" Tickets";
     var tCode=generateRandomString();
     var tMode="card";
     var tOptions="card";
     var tCurrency="KES";
     var tCountry="KE";


     //userNumber= userNumber.substring(0,2) == "07" ?  "254"+userNumber.substring(1) : userNumber;
     userOccupation= userOccupation == undefined || userOccupation == "" ? "Occupation Not Set" : userOccupation;
     userCompanyName= userCompanyName == undefined || userCompanyName == "" ? "Company Not Set" : userCompanyName;

    //var ticketAmount = ticketCost * $("#refx").val();

    var ticketAmount=ticketPrice * ticketNumber * $("#refx").val();
    ticketAmount=Math.round(ticketAmount);



     if(userGender == undefined || userGender == "" )
     {
       userGender="Gender Not Set";
     }
     else if(userGender == 1)
     {
      userGender="Male";
     }

     else if(userGender == 2)
     {
      userGender="Female";
     }


     if(userAge == undefined || userAge == "" )
     {
       userAge=getRandomAgeBetween(19,26);
     }
     else if(userAge == 1)
     {
      userAge=getRandomAgeBetween(18,25);
     }

     else if(userAge == 2)
     {
      userAge=getRandomAgeBetween(18,25);
     }

     else if(userAge == 3)
     {
      userAge=getRandomAgeBetween(26,36);
     }

     else if(userAge == 4)
     {
      userAge=getRandomAgeBetween(37,45);
     }

     else if(userAge == 5)
     {
      userAge=getRandomAgeBetween(46,60);
     }



     if(ticketNumber == undefined || ticketNumber < 1)
       {

         swal({
                    title: "Select Number of Tickets",
                    html:true,
                    text: "You need to select atleast one ticket" ,
                    type: "error",
                    closeOnConfirm: true,

                });

       }

     else if(ticketPrice == undefined || ticketPrice < 1)
       {

         swal({
                    title: "Select Ticket Type",
                    html:true,
                    text: "You need to select atleast one ticket type" ,
                    type: "error",
                    closeOnConfirm: true,

                });

       }


       else if(ticketCost == undefined || ticketCost == 0)
       {

         swal({
                    title: "Select Ticket",
                    html:true,
                    text: "You need to select atleast one ticket" ,
                    type: "error",
                    closeOnConfirm: true,

                });

       }

   

       else if(userFName == "")
       {

         swal({
                    title: "Enter First Name",
                    html:true,
                    text: "You need to enter your first name" ,
                    type: "error",
                    closeOnConfirm: true,

                });

       }


       else if(userEmail == "" && userNumber.length < 10)
       {

         swal({
                    title: "Enter Your Email or Provide Phone Number",
                    html:true,
                    text: "You need to enter an email or fill the phone number field" ,
                    type: "error",
                    closeOnConfirm: true,

                });

       }

       else if(userNumber != "" && userNumber.length < 10)
       {

         swal({
                    title: "Phone Number",
                    html:true,
                    text: "You need to enter a valid phone number" ,
                    type: "error",
                    closeOnConfirm: true,

                });

       }


       else
       {


        //Insert Pending Payment

       var transactionId=tCode;
       var transactionRefNumber="pending";
       var transactionReferallCode=$("#treferall").val();
       var transactionRefType="CARD";
       var transactionStatus="pending";
       var transactionType="card";
       var transactionFor="ticket";
       var transactionDateTime=getCurrentDate()+" "+getCurrentTime();
       var transactionDate=getCurrentDate();
       var transactionTime= getCurrentTime();


       //Clean Strings
       userFName=cleanString(userFName);
       userLName=cleanString(userLName);
       userCompanyName=cleanString(userCompanyName);
       userOccupation=cleanString(userOccupation);
      
       var userName=userFName+" "+userLName;
      
      //Add children
      var children=[];
      children.push(userName);
      var numberOfChildren=ticketNumber;
      if(ticketMode=="group")
      {
        numberOfChildren=ticketModeNumber;
      }

      for (var i = 0; i <numberOfChildren-1; i++) {
            var name =$("input[name='children["+i+"]']").val();
            console.log("Name Is"+name);
            if(name=="" || name == undefined)
            {
                children.push(userName);
            }
            else{
               children.push(name);
            }
        }
      
      
      //  alert(children);
      //  console.log(children);

       var transactionData = {

        'ticketeventid':eventId,
        'ticketnumberoftickets':ticketNumber,
        'tickettype':ticketType,
        'tickettypeid':ticketTypeMainId,
        'ticketprice':ticketPrice,
        'ticketmode':ticketMode,
        'ticketmodenumber':ticketModeNumber,
        'ticketchildren':children,
        'ticketuseremail':userEmail,
        'ticketusername':userFName+" "+userLName,
        'ticketusercompany':userCompanyName,
        'ticketuseroccupation':userOccupation,
        'ticketusergender':userGender,
        'ticketuserage':userAge,
        'ticketinitiator':"web",
        'tickettransactionreftype':transactionRefType,
        'ticketreferall':transactionReferallCode,

        };

       transactionData= JSON.stringify(transactionData);

       postPendingCardPayment(transactionId,userNumber,ticketAmount,transactionRefType,transactionRefNumber,eventId,transactionStatus,transactionType,transactionFor,transactionData,transactionDateTime,transactionDate,transactionTime,transactionReferallCode,transactionRefType,PBFKey,ticketAmount,tCountry,tCurrency,tDescription,tLogo,tTitle,userEmail,userFName,userLName,userNumber,tMode,tOptions,tCode,eventId,ticketNumber,ticketType,ticketPrice,userCompanyName,userOccupation,userGender,userAge,transactionRefType,transactionReferallCode);

     
     

      }
});

});


function postSuccessfullCardPayment(transactionId,userNumber,ticketCost,transactionRefType,transactionRefNumber,eventId,transactionStatus,transactionType,transactionFor,transactionData,transactionDateTime,transactionDate,transactionTime,transactionReferallCode,transactionRefType)
{

 var dataString = 'transaction_id='+ transactionId + '&transaction_phone='+ userNumber + '&transaction_amount='+ ticketCost+ '&transaction_ref_type='+ transactionRefType+ '&transaction_ref_number='+ transactionRefNumber+ '&transaction_ref_id='+ eventId+ '&transaction_status='+ transactionStatus+ '&transaction_type='+ transactionType+ '&transaction_for='+ transactionFor+ '&transaction_data='+ transactionData+ '&transaction_date_time='+ transactionDateTime+ '&transaction_date='+ transactionDate+ '&transaction_time='+ transactionTime+ '&transaction_referall='+ transactionReferallCode+ '&tickettransactionreftype='+ transactionRefType;

    $.ajax({
        type: "POST",
        url: "/api/add_payment",
        data: dataString,
        cache: false,
        success: function(response)
        {

            var result_code = response.result_code;
            var data = response.data;
            var message = response.message;
            console.log(response);

            if(result_code == 0)
            {

              dispResponse = 'Successfully Processed the Payment.';
              swal({
                  title: "Success",
                  text: "Ticket(s) purchased successfully. You will receive an SMS or email notification shortly with your e-Ticket(s)." ,
                  type: "success",
                  confirmButtonColor: "#e91e63",
                  confirmButtonText: "View More Events",
                  html:true,
                  closeOnConfirm: true,

                  },function(isConfirm){

                     location.href ="https://gig.co.ke";
                  });

          }
          else
          {

            dispResponse = 'Failed. Payment received but could not receipt the payment. Please contact admin';

            swal({
                title: "Failed",
                html:true,
                text: message,
                type: "error",
                closeOnConfirm: true,

            },

                  function(isConfirm)
                  {
                      if (isConfirm)
                      {

                          $('#reg-form')[0].reset();
                          $('select').material_select();
                          $("html, body").animate({ scrollTop: 0 }, "slow");
                          $('#progressbar').hide();

                          $("#refx").val("1");
                          $("#treferall").val("GIG");
                          $('#btn-referall').show();
                          $('#applied-view').hide();
                          $("#children-section").hide();

                          swal.close();
                      }

                  }
          );




        }

        showResponse(dispResponse);

    },
     error: function(response)
      {

             swal({
                title: "Failed",
                html:true,
                text: "Error. Payment received but coult not receipt the payment. Please contact admin." ,
                type: "error",
                closeOnConfirm: true,

            },

                  function(isConfirm)
                  {
                      if (isConfirm)
                      {

                          $('#reg-form')[0].reset();
                          $('select').material_select();
                          $("html, body").animate({ scrollTop: 0 }, "slow");
                          $('#progressbar').hide();

                          $("#refx").val("1");
                          $("#treferall").val("GIG");
                          $('#btn-referall').show();
                          $('#applied-view').hide();
                          $("#children-section").hide();

                          swal.close();
                      }

                  }
            );


     }

});


         

}


function postPendingCardPayment(transactionId,userNumber,ticketCost,transactionRefType,transactionRefNumber,eventId,transactionStatus,transactionType,transactionFor,transactionData,transactionDateTime,transactionDate,transactionTime,transactionReferallCode,transactionRefType,PBFKey,ticketAmount,tCountry,tCurrency,tDescription,tLogo,tTitle,userEmail,userFName,userLName,userNumber,tMode,tOptions,tCode,eventId,ticketNumber,ticketType,ticketPrice,userCompanyName,userOccupation,userGender,userAge,transactionRefType,transactionReferallCode)
{

 var dataString = 'transaction_id='+ transactionId + '&transaction_phone='+ userNumber + '&transaction_amount='+ ticketCost+ '&transaction_ref_type='+ transactionRefType+ '&transaction_ref_number='+ transactionRefNumber+ '&transaction_ref_id='+ eventId+ '&transaction_status='+ transactionStatus+ '&transaction_type='+ transactionType+ '&transaction_for='+ transactionFor+ '&transaction_data='+ transactionData+ '&transaction_date_time='+ transactionDateTime+ '&transaction_date='+ transactionDate+ '&transaction_time='+ transactionTime+ '&transaction_referall='+ transactionReferallCode+ '&tickettransactionreftype='+ transactionRefType;

    $.ajax({
        type: "POST",
        url: "/api/add_payment",
        data: dataString,
        cache: false,
        success: function(response)
        {

            var result_code = response.result_code;
            var data = response.data;
            var message = response.message;
            console.log(response);

            if(result_code == 0)
            {
            
                console.log("Success: Pending Payment Added Successfully");

                //Continue to Process Card
                 var hashedPayload='';
                 var payload= { 'PBFPubKey': PBFKey,
                      'amount': ticketAmount,
                      'country': tCountry,
                      'currency': tCurrency,
                      'custom_description': tDescription,
                      'custom_logo': tLogo,
                      'custom_title': tTitle,
                      'customer_email': userEmail,
                      'customer_firstname': userFName,
                      'customer_lastname': userLName,
                      'customer_phone': userNumber,
                      'payment_method': tMode,
                      'payment_options':tOptions,
                      'txref': tCode };
              
                const keys =  Object.keys(payload).sort();
                for(var index in keys){
                      const key = keys[index];
                      hashedPayload += payload[key];
                  }


                var hashString = hashedPayload + "FLWSECK-b7db0748a5aa60cec304c64700d5f315-X";

                // Initiate Payment Dialog
                  
                  getpaidSetup({
                    PBFPubKey: PBFKey,
                    customer_email: userEmail,
                    customer_firstname: userFName,
                    customer_lastname: userLName,
                    custom_description: tDescription,
                    custom_logo: tLogo,
                    custom_title: tTitle,
                    amount: ticketAmount,
                    customer_phone: userNumber,
                    country: tCountry,
                    currency: tCurrency,
                    payment_options:tOptions,
                    txref: tCode,
                    //integrity_hash: "6800d2dcbb7a91f5f9556e1b5820096d3d74ed4560343fc89b03a42701da4f30",
                    onclose: function() {

                      console.log('closed dialog');
                      //Update Pending as failed closed
                      postUpdateCardPaymentFailed(transactionId);

                    },
                    callback: function(response) {
                     // collect flwRef returned and pass to a  server page to complete status check.
                      console.log("This is the response returned after a charge", response);
                      if (response.tx.chargeResponseCode == "00" ||response.tx.chargeResponseCode == "0") 
                      {
                         
                         // redirect to a success page
                         var transactionId=tCode;
                         var transactionRefNumber=response.tx.flwRef;
                         var transactionReferallCode=$("#treferall").val();
                         var transactionRefType="CARD";
                         var transactionStatus="complete";
                         var transactionType="card";
                         var transactionFor="ticket";
                         var transactionDateTime=getCurrentDate()+" "+getCurrentTime();
                         var transactionDate=getCurrentDate();
                         var transactionTime= getCurrentTime();


                  


                         var transactionData = {

                          'ticketeventid':eventId,
                          'ticketnumberoftickets':ticketNumber,
                          'tickettype':ticketType,
                          'ticketprice':ticketPrice,
                          'ticketuseremail':userEmail,
                          'ticketusername':userFName+" "+userLName,
                          'ticketusercompany':userCompanyName,
                          'ticketuseroccupation':userOccupation,
                          'ticketusergender':userGender,
                          'ticketuserage':userAge,
                          'ticketinitiator':"web",
                          'tickettransactionreftype':transactionRefType,
                          'ticketreferall':transactionReferallCode,

                          };

                         transactionData= JSON.stringify(transactionData);

                         postSuccessfullCardPayment(transactionId,userNumber,ticketAmount,transactionRefType,transactionRefNumber,eventId,transactionStatus,transactionType,transactionFor,transactionData,transactionDateTime,transactionDate,transactionTime,transactionReferallCode,transactionRefType);



                      } else 
                      {
                        //Payment Faled Update
                        postUpdateCardPaymentFailed(transactionId);

                        // show failed.
                        swal({
                            title: "Failed",
                            html:true,
                            text: "Failed. Could not process the payment. Try again and contact admin if problem continues." ,
                            type: "error",
                            closeOnConfirm: true,

                              },

                                function(isConfirm)
                                {
                                    if (isConfirm)
                                    {

                                        $('#reg-form')[0].reset();
                                        $('select').material_select();
                                        $("html, body").animate({ scrollTop: 0 }, "slow");
                                        $('#progressbar').hide();

                                        $("#refx").val("1");
                                        $("#treferall").val("GIG");
                                        $('#btn-referall').show();
                                        $('#applied-view').hide();
                                        $("#children-section").hide();

                                        swal.close();
                                    }

                                }
                          );


                      }
                    }
                  });

                  }
                  else
                  {
                    swal({
                        title: "Reload",
                        text: "Refresh the page." ,
                        type: "error",
                        html:true,
                        closeOnConfirm: true,

                       },

                        function(isConfirm)
                        {
                            if (isConfirm)
                            {

                                location.reload();
                            }

                        }
                     );

                     console.log("Failed: Pending Payment Not Added");
                  }


          },
           error: function(response)
            {
              swal({
                        title: "Reload",
                        text: "Refresh the page." ,
                        type: "error",
                        html:true,
                        closeOnConfirm: true,

                       },

                        function(isConfirm)
                        {
                            if (isConfirm)
                            {

                                location.reload();
                            }

                        }
                     );

              console.log("Error: Pending Payment Not Added");
            }

});


         

}



// End Card Payments -->


function SHA256(s){
 var chrsz  = 8;
 var hexcase = 0;
 function safe_add (x, y) {
 var lsw = (x & 0xFFFF) + (y & 0xFFFF);
 var msw = (x >> 16) + (y >> 16) + (lsw >> 16);
 return (msw << 16) | (lsw & 0xFFFF);
 }
 function S (X, n) { return ( X >>> n ) | (X << (32 - n)); }
 function R (X, n) { return ( X >>> n ); }
 function Ch(x, y, z) { return ((x & y) ^ ((~x) & z)); }
 function Maj(x, y, z) { return ((x & y) ^ (x & z) ^ (y & z)); }
 function Sigma0256(x) { return (S(x, 2) ^ S(x, 13) ^ S(x, 22)); }
 function Sigma1256(x) { return (S(x, 6) ^ S(x, 11) ^ S(x, 25)); }
 function Gamma0256(x) { return (S(x, 7) ^ S(x, 18) ^ R(x, 3)); }
 function Gamma1256(x) { return (S(x, 17) ^ S(x, 19) ^ R(x, 10)); }
 function core_sha256 (m, l) {
 var K = new Array(0x428A2F98, 0x71374491, 0xB5C0FBCF, 0xE9B5DBA5, 0x3956C25B, 0x59F111F1, 0x923F82A4, 0xAB1C5ED5, 0xD807AA98, 0x12835B01, 0x243185BE, 0x550C7DC3, 0x72BE5D74, 0x80DEB1FE, 0x9BDC06A7, 0xC19BF174, 0xE49B69C1, 0xEFBE4786, 0xFC19DC6, 0x240CA1CC, 0x2DE92C6F, 0x4A7484AA, 0x5CB0A9DC, 0x76F988DA, 0x983E5152, 0xA831C66D, 0xB00327C8, 0xBF597FC7, 0xC6E00BF3, 0xD5A79147, 0x6CA6351, 0x14292967, 0x27B70A85, 0x2E1B2138, 0x4D2C6DFC, 0x53380D13, 0x650A7354, 0x766A0ABB, 0x81C2C92E, 0x92722C85, 0xA2BFE8A1, 0xA81A664B, 0xC24B8B70, 0xC76C51A3, 0xD192E819, 0xD6990624, 0xF40E3585, 0x106AA070, 0x19A4C116, 0x1E376C08, 0x2748774C, 0x34B0BCB5, 0x391C0CB3, 0x4ED8AA4A, 0x5B9CCA4F, 0x682E6FF3, 0x748F82EE, 0x78A5636F, 0x84C87814, 0x8CC70208, 0x90BEFFFA, 0xA4506CEB, 0xBEF9A3F7, 0xC67178F2);
 var HASH = new Array(0x6A09E667, 0xBB67AE85, 0x3C6EF372, 0xA54FF53A, 0x510E527F, 0x9B05688C, 0x1F83D9AB, 0x5BE0CD19);
 var W = new Array(64);
 var a, b, c, d, e, f, g, h, i, j;
 var T1, T2;
 m[l >> 5] |= 0x80 << (24 - l % 32);
 m[((l + 64 >> 9) << 4) + 15] = l;
 for ( var i = 0; i<m.length; i+=16 ) {
 a = HASH[0];
 b = HASH[1];
 c = HASH[2];
 d = HASH[3];
 e = HASH[4];
 f = HASH[5];
 g = HASH[6];
 h = HASH[7];
 for ( var j = 0; j<64; j++) {
 if (j < 16) W[j] = m[j + i];
 else W[j] = safe_add(safe_add(safe_add(Gamma1256(W[j - 2]), W[j - 7]), Gamma0256(W[j - 15])), W[j - 16]);
 T1 = safe_add(safe_add(safe_add(safe_add(h, Sigma1256(e)), Ch(e, f, g)), K[j]), W[j]);
 T2 = safe_add(Sigma0256(a), Maj(a, b, c));
 h = g;
 g = f;
 f = e;
 e = safe_add(d, T1);
 d = c;
 c = b;
 b = a;
 a = safe_add(T1, T2);
 }
 HASH[0] = safe_add(a, HASH[0]);
 HASH[1] = safe_add(b, HASH[1]);
 HASH[2] = safe_add(c, HASH[2]);
 HASH[3] = safe_add(d, HASH[3]);
 HASH[4] = safe_add(e, HASH[4]);
 HASH[5] = safe_add(f, HASH[5]);
 HASH[6] = safe_add(g, HASH[6]);
 HASH[7] = safe_add(h, HASH[7]);
 }
 return HASH;
 }
 function str2binb (str) {
 var bin = Array();
 var mask = (1 << chrsz) - 1;
 for(var i = 0; i < str.length * chrsz; i += chrsz) {
 bin[i>>5] |= (str.charCodeAt(i / chrsz) & mask) << (24 - i%32);
 }
 return bin;
 }
 function Utf8Encode(string) {
 string = string.replace(/\r\n/g,"\n");
 var utftext = "";
 for (var n = 0; n < string.length; n++) {
 var c = string.charCodeAt(n);
 if (c < 128) {
 utftext += String.fromCharCode(c);
 }
 else if((c > 127) && (c < 2048)) {
 utftext += String.fromCharCode((c >> 6) | 192);
 utftext += String.fromCharCode((c & 63) | 128);
 }
 else {
 utftext += String.fromCharCode((c >> 12) | 224);
 utftext += String.fromCharCode(((c >> 6) & 63) | 128);
 utftext += String.fromCharCode((c & 63) | 128);
 }
 }
 return utftext;
 }
 function binb2hex (binarray) {
 var hex_tab = hexcase ? "0123456789ABCDEF" : "0123456789abcdef";
 var str = "";
 for(var i = 0; i < binarray.length * 4; i++) {
 str += hex_tab.charAt((binarray[i>>2] >> ((3 - i%4)*8+4)) & 0xF) +
 hex_tab.charAt((binarray[i>>2] >> ((3 - i%4)*8 )) & 0xF);
 }
 return str;
 }
 s = Utf8Encode(s);
 return binb2hex(core_sha256(str2binb(s), s.length * chrsz));
}

function cleanString(reString)
{
  return reString.replace(/[|&;$%@"<>()'+,"]/g, "");
}

</script>





</body>
</html>
